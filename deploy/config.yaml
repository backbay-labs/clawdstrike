# Hushd Configuration
# Copy to /etc/hushd/config.yaml and customize

# Listen address
listen: "127.0.0.1:9876"

# Policy configuration
# Option 1: Use a named ruleset (default, strict, permissive)
ruleset: default

# Option 2: Use a custom policy file (uncomment)
# policy_path: /etc/hushd/policy.yaml

# Audit database path
audit_db: /var/lib/hushd/audit.db

# Log level: trace, debug, info, warn, error
log_level: info

# Signing key for receipts (optional)
# If not set, an ephemeral key is generated at startup
# signing_key: /etc/hushd/signing.key

# Optional: trusted public keys for verifying incoming signed policy bundles (enterprise distribution).
# If empty, hushd will only accept bundle updates when the bundle embeds a public_key.
# policy_bundle_trusted_pubkeys:
#   - "${CLAWDSTRIKE_POLICY_BUNDLE_PUBKEY}"

# Enable CORS for browser access
cors_enabled: true

# Maximum audit entries to keep (0 = unlimited)
max_audit_entries: 100000

# Audit encryption (optional)
# Stores the `metadata` blob encrypted at rest (searchable columns remain plaintext).
# Generate a key with: `openssl rand -hex 32 > /etc/hushd/audit.key`
# audit:
#   encryption:
#     enabled: true
#     key_source: file
#     key_path: /etc/hushd/audit.key

# Optional: forward audit events to external sinks (in addition to the SQLite ledger)
audit_forward:
  enabled: false
  queue_size: 8192
  timeout_ms: 2000
  sinks:
    # - type: stdout_jsonl
    # - type: file_jsonl
    #   path: /var/log/hushd/audit.jsonl
    # - type: webhook
    #   url: "${HUSHD_AUDIT_WEBHOOK_URL}"
    #   headers:
    #     Authorization: "Bearer ${HUSHD_AUDIT_WEBHOOK_TOKEN}"
    # - type: splunk_hec
    #   url: "https://splunk.example:8088"
    #   token: "${SPLUNK_HEC_TOKEN}"
    #   index: "main"
    #   sourcetype: "clawdstrike:audit"
    # - type: elastic
    #   url: "https://elasticsearch.example:9200"
    #   api_key: "${ELASTIC_API_KEY}"
    #   index: "clawdstrike-audit"

# TLS configuration (optional; enable native TLS in hushd)
# tls:
#   cert_path: /etc/hushd/cert.pem
#   key_path: /etc/hushd/key.pem

# API Authentication
# When enabled, all endpoints except /health require a valid API key
auth:
  enabled: true
  api_keys:
    # Default key with check/read permissions
    - name: "default"
      key: "${CLAWDSTRIKE_API_KEY}"  # Set via environment variable
      scopes: ["check", "read"]
    # Admin key with full permissions
    - name: "admin"
      key: "${CLAWDSTRIKE_ADMIN_KEY}"
      scopes: ["*"]
    # Example with expiration
    # - name: "temporary"
    #   key: "temp-key-12345"
    #   scopes: ["check"]
    #   expires_at: "2024-12-31T23:59:59Z"
